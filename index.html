<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Banking Mock Test App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
 box-sizing:border-box;
 font-family:Segoe UI,Roboto;
 -webkit-tap-highlight-color:transparent;
}
body{margin:0;background:#020617;color:#e5e7eb}
:root{
 --primary:#4f46e5;
 --border:#1e293b;
 --green:#22c55e;
 --red:#ef4444;
 --glow:#6366f1;
}
header{
 display:flex;justify-content:space-between;
 padding:14px 18px;border-bottom:1px solid var(--border)
}
button{
 background:var(--primary);color:#fff;border:none;
 padding:10px 14px;border-radius:12px;cursor:pointer
}
.container{max-width:900px;margin:auto;padding:20px}
.card{
 background:#020617;border-radius:18px;
 padding:20px;margin-bottom:20px;
 box-shadow:0 0 18px rgba(79,70,229,.25)
}
.hidden{display:none}

/* SUBJECT */
.subject-grid{
 display:grid;grid-template-columns:repeat(2,1fr);gap:14px
}
.subject-card{
 border:1px solid var(--border);
 border-radius:16px;padding:18px;text-align:center;
 cursor:pointer
}
.subject-card.active{
 border-color:var(--green);
 background:rgba(34,197,94,.15)
}

/* TOTAL */
.total-card{
 display:flex;gap:12px;border:1px solid var(--border);
 border-radius:16px;padding:16px;margin-bottom:20px
}

/* OPTIONS */
.option{
 border:1px solid var(--border);
 padding:12px;border-radius:12px;
 margin:8px 0;cursor:pointer
}
.option.active{background:var(--primary)}
.correct{background:var(--green)}
.wrong{background:var(--red)}

/* SCORE */
.score-wrap{display:flex;gap:20px;flex-wrap:wrap}
.ring{
 width:120px;height:120px;border-radius:50%;
 display:flex;align-items:center;justify-content:center;
 font-size:24px;font-weight:bold;
 background:conic-gradient(var(--glow) 0deg,#1e293b 0deg);
 box-shadow:0 0 25px rgba(99,102,241,.6)
}
.score-box{
 flex:1;border:1px solid var(--border);
 border-radius:14px;padding:14px
}
.badge{
 margin-top:10px;padding:10px;border-radius:12px;
 text-align:center;font-weight:600
}
.good{background:rgba(34,197,94,.2)}
.avg{background:rgba(234,179,8,.2)}
.bad{background:rgba(239,68,68,.2)}

textarea{
 width:100%;height:200px;
 background:#020617;color:#fff;
 border:1px solid var(--border);
 border-radius:12px;padding:12px
}
</style>
</head>

<body>

<header>
 <b>üè¶ Banking Mock Test</b>
 <div>
  <button onclick="openImporter()">Upload Questions</button>
  <button onclick="goHome()">Home</button>
 </div>
</header>

<div class="container">

<!-- HOME -->
<div class="card" id="home">

 <div class="total-card">üìö <b id="totalBox">0</b></div>

 <div class="subject-grid">
  <div class="subject-card" onclick="selectSubject('Computer',this)">üíª Computer</div>
  <div class="subject-card" onclick="selectSubject('Static GK',this)">üìò Static GK</div>
  <div class="subject-card" onclick="selectSubject('Current Affairs',this)">üì∞ Current Affairs</div>
  <div class="subject-card" onclick="selectSubject('Mix',this)">üîÄ Mix</div>
 </div>

 <h3>Questions: <span id="qVal">5</span></h3>
 <input type="range" min="1" max="50" value="5"
  id="qSlider" oninput="qVal.innerText=this.value">

 <br>
 <button onclick="startTest()">Start Test</button>
</div>

<!-- TEST -->
<div class="card hidden" id="test">
 <div id="timer"></div>
 <div id="progress"></div>
 <h3 id="qText"></h3>
 <div id="options"></div>
 <button onclick="nextQ()">Next</button>
</div>

<!-- RESULT -->
<div class="card hidden" id="result">
 <h2>Scorecard</h2>
 <div class="score-wrap">
  <div class="ring" id="ring">0%</div>
  <div class="score-box">
   <div>Total: <b id="scTotal"></b></div>
   <div>Correct: <b id="scCorrect"></b></div>
   <div>Wrong: <b id="scWrong"></b></div>
   <div>Time Taken: <b id="scTime"></b></div>
  </div>
 </div>
 <div id="perfBadge" class="badge"></div>
 <button onclick="showAnalysis()">Analysis</button>
 <button onclick="goHome()">Home</button>
</div>

<!-- ANALYSIS -->
<div class="card hidden" id="analysis">
 <h2>Detailed Analysis</h2>
 <div id="analysisBox"></div>
 <button onclick="goHome()">Home</button>
</div>

<!-- UPLOAD -->
<div class="card hidden" id="importer">
 <h3>Upload Questions (JSON)</h3>
 <textarea id="jsonInput" placeholder="Paste JSON here"></textarea>
 <button onclick="importQuestions()">Add</button>
 <button onclick="closeImporter()">Close</button>
</div>

</div>

<script>
/* ========= KEYS ========= */
const QKEY="BANKING_MOCK_QUESTIONS";
const HISTORY_KEY="DAILY_USED";

/* ========= NORMALIZE SUBJECT ========= */
function normalizeSubject(s){
 s=s.toLowerCase().replace(/\s+/g,"");
 if(s.includes("computer")) return "Computer";
 if(s.includes("static")) return "Static GK";
 if(s.includes("current")||s.includes("ca")||s.includes("gs"))
  return "Current Affairs";
 return "Computer";
}

/* ========= LOAD QUESTIONS ========= */
let allQuestions=JSON.parse(localStorage.getItem(QKEY))||[
 {subject:"Computer",q:"CPU ‡§ï‡§æ full form ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?",options:["Central Processing Unit","Control Unit","Computer Unit","None"],answer:0,explanation:"CPU = Central Processing Unit"}
];
allQuestions=allQuestions.map(q=>({...q,subject:normalizeSubject(q.subject)}));
localStorage.setItem(QKEY,JSON.stringify(allQuestions));
totalBox.innerText=allQuestions.length;

/* ========= STATE ========= */
let selectedSubject=null,testQ=[],i=0,score=0,answers=[];
let time=0,timerInt,startTime=0;

/* ========= SUBJECT ========= */
function selectSubject(sub,card){
 selectedSubject=sub;
 document.querySelectorAll(".subject-card").forEach(c=>c.classList.remove("active"));
 card.classList.add("active");
}

/* ========= START TEST ========= */
function startTest(){
 if(!selectedSubject)return alert("Select subject");

 const subjectKey = normalizeSubject(selectedSubject);

 let pool = subjectKey==="Mix"
  ? allQuestions
  : allQuestions.filter(q=>q.subject===subjectKey);

 let today=new Date().toISOString().split("T")[0];
 let history=JSON.parse(localStorage.getItem(HISTORY_KEY))||{};
 let used=(history[today]?.[subjectKey])||[];

 let fresh=pool.filter(q=>!used.includes(q.q));
 if(fresh.length===0){fresh=pool;used=[];}

 testQ=fresh.sort(()=>0.5-Math.random())
 .slice(0,Math.min(+qSlider.value,fresh.length));

 history[today]=history[today]||{};
 history[today][subjectKey]=used.concat(testQ.map(q=>q.q));
 localStorage.setItem(HISTORY_KEY,JSON.stringify(history));

 i=0;score=0;answers=[];
 home.classList.add("hidden");
 test.classList.remove("hidden");

 time=testQ.length*30;
 startTime=time;
 timer.innerText="‚è± "+time+" sec";
 timerInt=setInterval(()=>{
  time--;
  timer.innerText="‚è± "+time+" sec";
  if(time<=0){clearInterval(timerInt);submit();}
 },1000);

 loadQ();
}

function loadQ(){
 let q=testQ[i];
 progress.innerText=`Question ${i+1}/${testQ.length}`;
 qText.innerText=q.q;
 options.innerHTML="";
 q.options.forEach((o,idx)=>{
  options.innerHTML+=`<div class="option" onclick="selectOpt(${idx})">${o}</div>`;
 });
}

let sel=null;
function selectOpt(n){
 sel=n;
 document.querySelectorAll(".option").forEach(o=>o.classList.remove("active"));
 document.querySelectorAll(".option")[n].classList.add("active");
}

function nextQ(){
 if(sel==null)return alert("Select option");
 answers.push(sel);
 if(sel===testQ[i].answer)score++;
 sel=null;

 if(i<testQ.length-1){i++;loadQ();}
 else{clearInterval(timerInt);submit();}
}

/* ========= RESULT ========= */
function submit(){
 test.classList.add("hidden");
 result.classList.remove("hidden");

 let percent=Math.round(score/testQ.length*100);
 ring.innerText=percent+"%";
 ring.style.background=`conic-gradient(var(--glow) ${percent*3.6}deg,#1e293b 0deg)`;

 scTotal.innerText=testQ.length;
 scCorrect.innerText=score;
 scWrong.innerText=testQ.length-score;
 scTime.innerText=(startTime-time)+" sec";

 perfBadge.className="badge "+(percent>=75?"good":percent>=50?"avg":"bad");
 perfBadge.innerText=
  percent>=75?"Excellent Performance üî•":
  percent>=50?"Good Attempt üôÇ":
  "Practice More üí™";
}

/* ========= ANALYSIS ========= */
function showAnalysis(){
 result.classList.add("hidden");
 analysis.classList.remove("hidden");
 analysisBox.innerHTML="";
 testQ.forEach((q,idx)=>{
  let h=`<p><b>${q.q}</b></p>`;
  q.options.forEach((o,i)=>{
   let cls=i===q.answer?"correct":(i===answers[idx]?"wrong":"");
   h+=`<div class="option ${cls}">${o}</div>`;
  });
  h+=`<p>${q.explanation}</p><hr>`;
  analysisBox.innerHTML+=h;
 });
}

/* ========= UPLOAD ========= */
function openImporter(){importer.classList.remove("hidden")}
function closeImporter(){importer.classList.add("hidden")}
function importQuestions(){
 try{
  let data=JSON.parse(jsonInput.value)
   .map(q=>({...q,subject:normalizeSubject(q.subject)}));
  allQuestions.push(...data);
  localStorage.setItem(QKEY,JSON.stringify(allQuestions));
  totalBox.innerText=allQuestions.length;
  jsonInput.value="";
  alert("Questions saved");
  closeImporter();
 }catch{alert("Invalid JSON")}
}

function goHome(){location.reload()}
</script>

</body>
</html>
